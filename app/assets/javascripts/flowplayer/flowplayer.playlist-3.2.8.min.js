(function(a){$f.addPlugin("playlist",function(g,d){var j=this;var i={playingClass:"playing",pausedClass:"paused",progressClass:"progress",stoppedClass:"stopped",template:'<a href="${url}">${title}</a>',loop:false,continuousPlay:false,playOnClick:true,manual:false};a.extend(i,d);g=a(g);var f=k();var b=i.manual||(f.length>0&&!g.html().match(/\$/));var s=null;function l(v){var u=s;a.each(v,function(w,x){if(!a.isFunction(x)){u=u.replace("${"+w+"}",x).replace("$%7B"+w+"%7D",x)}});return u}function c(){f=k().unbind("click.playlist").bind("click.playlist",function(){return p(a(this),f.index(this))})}function m(){g.empty();a.each(j.getPlaylist(),function(){g.append(l(this))});c()}function p(u,v){if(u.hasClass(i.playingClass)||u.hasClass(i.pausedClass)){j.toggle()}else{u.addClass(i.progressClass);j.play(v)}return false}function e(){if(b){f=k()}f.removeClass(i.playingClass);f.removeClass(i.pausedClass);f.removeClass(i.progressClass);f.removeClass(i.stoppedClass)}function t(u){return(b)?f.filter('[href="'+u.originalUrl+'"]'):f.eq(u.index)}function k(){var u=g.find("a");return u.length?u:g.children()}if(!b){s=g.children().length<=0?i.template:g.html();m()}else{s=i.template;c();var n=[];a.each(f,function(u,v){n.push({url:encodeURI(a(v).attr("href"))})});j.onLoad(function(){j.setPlaylist(n)});var o=j.getClip(0);if(!o.url&&i.playOnClick){o.update({url:encodeURI(f.eq(0).attr("href"))})}}j.onBegin(function(u){e();t(u).addClass(i.playingClass)});j.onPause(function(u){t(u).removeClass(i.playingClass).addClass(i.pausedClass)});j.onResume(function(u){t(u).removeClass(i.pausedClass).addClass(i.playingClass)});function h(u){j.onBeforeFinish(function(v){t(v).removeClass(i.playingClass);t(v).addClass(i.stoppedClass);if(!v.isInStream&&v.index<f.length-1){return false}})}function r(u){j.onBeforeFinish(function(v){if(!v.isInStream&&v.index>=f.length-1){return false}})}function q(u){j.onBeforeFinish(function(v){if(!v.isInStream&&v.index<f.length-1&&!j.getClip(v.index+1).autoPlay){j.play(v.index+1);return false}})}if(!i.loop&&!i.continuousPlay){h(o)}else{if(i.loop){r(o)}else{q(o)}}j.onUnload(function(){e()});if(!b){j.onPlaylistReplace(function(){m()})}j.onClipAdd(function(v,u){if(s){if(u<f.length){k().eq(u).before(l(v))}else{k().eq(u-1).after(l(v))}}c()});return j})})(jQuery);